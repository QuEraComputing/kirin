<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Kirin - Kernel Intermediate Representation Infrastructure"><link href=https://special-broccoli-revrkk1.pages.github.io/blog/ rel=canonical><link href=../contrib/ rel=prev><link href=archive/2024/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.44"><title>Blog - kirin-toolchain</title><link rel=stylesheet href=../assets/stylesheets/main.0253249f.min.css><link rel=stylesheet href=../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><link rel=stylesheet href=../stylesheets/extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=custom> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#blog class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=kirin-toolchain class="md-header__button md-logo" aria-label=kirin-toolchain data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> kirin-toolchain </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Blog </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=custom data-md-color-accent=custom aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=custom data-md-color-accent=custom aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/QuEraComputing/kirin title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> kirin-toolchain </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Blog </a> </li> <li class=md-tabs__item> <a href=../reference/kirin/prelude/ class=md-tabs__link> API Reference </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=kirin-toolchain class="md-nav__button md-logo" aria-label=kirin-toolchain data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> kirin-toolchain </label> <div class=md-nav__source> <a href=https://github.com/QuEraComputing/kirin title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> kirin-toolchain </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=.. class="md-nav__link "> <span class=md-ellipsis> Home </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> Home </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../install/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../def/ class=md-nav__link> <span class=md-ellipsis> Declarations </span> </a> </li> <li class=md-nav__item> <a href=../101/ class=md-nav__link> <span class=md-ellipsis> Compiler 101 </span> </a> </li> <li class=md-nav__item> <a href=../contrib/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <div class="md-nav__link md-nav__container"> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link md-nav__link--active" for=__nav_2 id=__nav_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> API Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> API Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/prelude/ class=md-nav__link> <span class=md-ellipsis> Prelude </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/ir/ class="md-nav__link "> <span class=md-ellipsis> IR </span> </a> <label class="md-nav__link " for=__nav_3_2 id=__nav_3_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> IR </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2_2> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/ir/nodes/ class="md-nav__link "> <span class=md-ellipsis> Nodes </span> </a> <label class="md-nav__link " for=__nav_3_2_2 id=__nav_3_2_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2_2> <span class="md-nav__icon md-icon"></span> Nodes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/ir/nodes/base/ class=md-nav__link> <span class=md-ellipsis> Base </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/nodes/block/ class=md-nav__link> <span class=md-ellipsis> Block </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/nodes/region/ class=md-nav__link> <span class=md-ellipsis> Region </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/nodes/stmt/ class=md-nav__link> <span class=md-ellipsis> Stmt </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/nodes/view/ class=md-nav__link> <span class=md-ellipsis> View </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/ssa/ class=md-nav__link> <span class=md-ellipsis> SSA values </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/attrs/ class=md-nav__link> <span class=md-ellipsis> Attributes </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/traits/ class=md-nav__link> <span class=md-ellipsis> Traits </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/dialect/ class=md-nav__link> <span class=md-ellipsis> Dialect </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/group/ class=md-nav__link> <span class=md-ellipsis> Dialect Group </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/ir/method/ class=md-nav__link> <span class=md-ellipsis> Method </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/interp/ class="md-nav__link "> <span class=md-ellipsis> Interpreter </span> </a> <label class="md-nav__link " for=__nav_3_3 id=__nav_3_3_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Interpreter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/interp/abstract/ class=md-nav__link> <span class=md-ellipsis> Abstract </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/base/ class=md-nav__link> <span class=md-ellipsis> Base </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/concrete/ class=md-nav__link> <span class=md-ellipsis> Concrete </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/dialect/ class=md-nav__link> <span class=md-ellipsis> Dialect </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/frame/ class=md-nav__link> <span class=md-ellipsis> Frame </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/impl/ class=md-nav__link> <span class=md-ellipsis> Impl </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/state/ class=md-nav__link> <span class=md-ellipsis> State </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/interp/value/ class=md-nav__link> <span class=md-ellipsis> Value </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_4> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/lowering/ class="md-nav__link "> <span class=md-ellipsis> Python Lowering </span> </a> <label class="md-nav__link " for=__nav_3_4 id=__nav_3_4_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_4_label aria-expanded=false> <label class=md-nav__title for=__nav_3_4> <span class="md-nav__icon md-icon"></span> Python Lowering </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/lowering/core/ class=md-nav__link> <span class=md-ellipsis> Core </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/lowering/dialect/ class=md-nav__link> <span class=md-ellipsis> Dialect </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/lowering/frame/ class=md-nav__link> <span class=md-ellipsis> Frame </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/lowering/result/ class=md-nav__link> <span class=md-ellipsis> Result </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/lowering/state/ class=md-nav__link> <span class=md-ellipsis> State </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/lowering/stream/ class=md-nav__link> <span class=md-ellipsis> Stream </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/analysis/ class="md-nav__link "> <span class=md-ellipsis> Analysis </span> </a> <label class="md-nav__link " for=__nav_3_5 id=__nav_3_5_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_5_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5> <span class="md-nav__icon md-icon"></span> Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_5_2> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/analysis/dataflow/ class="md-nav__link "> <span class=md-ellipsis> Dataflow </span> </a> <label class="md-nav__link " for=__nav_3_5_2 id=__nav_3_5_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_5_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_5_2> <span class="md-nav__icon md-icon"></span> Dataflow </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/analysis/dataflow/constprop/ class=md-nav__link> <span class=md-ellipsis> Constprop </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/analysis/dataflow/forward/ class=md-nav__link> <span class=md-ellipsis> Forward </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/analysis/dataflow/typeinfer/ class=md-nav__link> <span class=md-ellipsis> Typeinfer </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../reference/kirin/analysis/cfg/ class=md-nav__link> <span class=md-ellipsis> CFG </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6> <label class=md-nav__link for=__nav_3_6 id=__nav_3_6_label tabindex=0> <span class=md-ellipsis> Rewrite </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6> <span class="md-nav__icon md-icon"></span> Rewrite </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_1> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/rewrite/ class="md-nav__link "> <span class=md-ellipsis> Generic </span> </a> <label class="md-nav__link " for=__nav_3_6_1 id=__nav_3_6_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_1_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_1> <span class="md-nav__icon md-icon"></span> Generic </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/rewrite/abc/ class=md-nav__link> <span class=md-ellipsis> Abc </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rewrite/chain/ class=md-nav__link> <span class=md-ellipsis> Chain </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rewrite/fixpoint/ class=md-nav__link> <span class=md-ellipsis> Fixpoint </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rewrite/result/ class=md-nav__link> <span class=md-ellipsis> Result </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rewrite/walk/ class=md-nav__link> <span class=md-ellipsis> Walk </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/rules/ class="md-nav__link "> <span class=md-ellipsis> Rules </span> </a> <label class="md-nav__link " for=__nav_3_6_2 id=__nav_3_6_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_6_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_2> <span class="md-nav__icon md-icon"></span> Rules </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/rules/alias/ class=md-nav__link> <span class=md-ellipsis> Alias </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/apply_type/ class=md-nav__link> <span class=md-ellipsis> Apply type </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/call2invoke/ class=md-nav__link> <span class=md-ellipsis> Call2invoke </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/cfg_compactify/ class=md-nav__link> <span class=md-ellipsis> Cfg compactify </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/cse/ class=md-nav__link> <span class=md-ellipsis> Cse </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/dce/ class=md-nav__link> <span class=md-ellipsis> Dce </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/fold/ class=md-nav__link> <span class=md-ellipsis> Fold </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/getfield/ class=md-nav__link> <span class=md-ellipsis> Getfield </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/getitem/ class=md-nav__link> <span class=md-ellipsis> Getitem </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/rules/inline/ class=md-nav__link> <span class=md-ellipsis> Inline </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_6_2_12> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/rules/aggressive/ class="md-nav__link "> <span class=md-ellipsis> Aggressive </span> </a> <label class="md-nav__link " for=__nav_3_6_2_12 id=__nav_3_6_2_12_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_3_6_2_12_label aria-expanded=false> <label class=md-nav__title for=__nav_3_6_2_12> <span class="md-nav__icon md-icon"></span> Aggressive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/rules/aggressive/fold/ class=md-nav__link> <span class=md-ellipsis> Fold </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/passes/ class="md-nav__link "> <span class=md-ellipsis> Method Pass </span> </a> <label class="md-nav__link " for=__nav_3_7 id=__nav_3_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Method Pass </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/passes/abc/ class=md-nav__link> <span class=md-ellipsis> Abc </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/passes/fold/ class=md-nav__link> <span class=md-ellipsis> Fold </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/passes/inline/ class=md-nav__link> <span class=md-ellipsis> Inline </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/passes/typeinfer/ class=md-nav__link> <span class=md-ellipsis> Typeinfer </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_7_6> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/passes/aggressive/ class="md-nav__link "> <span class=md-ellipsis> Aggressive </span> </a> <label class="md-nav__link " for=__nav_3_7_6 id=__nav_3_7_6_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_7_6_label aria-expanded=false> <label class=md-nav__title for=__nav_3_7_6> <span class="md-nav__icon md-icon"></span> Aggressive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/passes/aggressive/fold/ class=md-nav__link> <span class=md-ellipsis> Fold </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_8> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/codegen/ class="md-nav__link "> <span class=md-ellipsis> Code Generation </span> </a> <label class="md-nav__link " for=__nav_3_8 id=__nav_3_8_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_8_label aria-expanded=false> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Code Generation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/codegen/base/ class=md-nav__link> <span class=md-ellipsis> Base </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/codegen/dialect/ class=md-nav__link> <span class=md-ellipsis> Dialect </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/codegen/dict/ class=md-nav__link> <span class=md-ellipsis> Dict </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/codegen/impl/ class=md-nav__link> <span class=md-ellipsis> Impl </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/codegen/ssa/ class=md-nav__link> <span class=md-ellipsis> Ssa </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_9> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/print/ class="md-nav__link "> <span class=md-ellipsis> Pretty Printing </span> </a> <label class="md-nav__link " for=__nav_3_9 id=__nav_3_9_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_9_label aria-expanded=false> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Pretty Printing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/print/printable/ class=md-nav__link> <span class=md-ellipsis> Printable </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/print/printer/ class=md-nav__link> <span class=md-ellipsis> Printer </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/decl/ class="md-nav__link "> <span class=md-ellipsis> IR declaration </span> </a> <label class="md-nav__link " for=__nav_3_10 id=__nav_3_10_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_10_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10> <span class="md-nav__icon md-icon"></span> IR declaration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/decl/base/ class=md-nav__link> <span class=md-ellipsis> Base </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/camel2snake/ class=md-nav__link> <span class=md-ellipsis> Camel2snake </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/info/ class=md-nav__link> <span class=md-ellipsis> Info </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/scan_fields/ class=md-nav__link> <span class=md-ellipsis> Scan fields </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/verify/ class=md-nav__link> <span class=md-ellipsis> Verify </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_10_7> <div class="md-nav__link md-nav__container"> <a href=../reference/kirin/decl/emit/ class="md-nav__link "> <span class=md-ellipsis> Emit </span> </a> <label class="md-nav__link " for=__nav_3_10_7 id=__nav_3_10_7_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_3_10_7_label aria-expanded=false> <label class=md-nav__title for=__nav_3_10_7> <span class="md-nav__icon md-icon"></span> Emit </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/dialect/ class=md-nav__link> <span class=md-ellipsis> Dialect </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/from_python_call/ class=md-nav__link> <span class=md-ellipsis> From python call </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/init/ class=md-nav__link> <span class=md-ellipsis> Init </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/name/ class=md-nav__link> <span class=md-ellipsis> Name </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/property/ class=md-nav__link> <span class=md-ellipsis> Property </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/repr/ class=md-nav__link> <span class=md-ellipsis> Repr </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/traits/ class=md-nav__link> <span class=md-ellipsis> Traits </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/typecheck/ class=md-nav__link> <span class=md-ellipsis> Typecheck </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/decl/emit/verify/ class=md-nav__link> <span class=md-ellipsis> Verify </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../reference/kirin/exceptions/ class=md-nav__link> <span class=md-ellipsis> Exceptions </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_12> <label class=md-nav__link for=__nav_3_12 id=__nav_3_12_label tabindex=0> <span class=md-ellipsis> Data Structures </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_12_label aria-expanded=false> <label class=md-nav__title for=__nav_3_12> <span class="md-nav__icon md-icon"></span> Data Structures </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../reference/kirin/lattice/abc/ class=md-nav__link> <span class=md-ellipsis> Lattice </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/graph/ class=md-nav__link> <span class=md-ellipsis> Graph </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/idtable/ class=md-nav__link> <span class=md-ellipsis> IdTable </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/source/ class=md-nav__link> <span class=md-ellipsis> Source </span> </a> </li> <li class=md-nav__item> <a href=../reference/kirin/worklist/ class=md-nav__link> <span class=md-ellipsis> WorkList </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <div class=md-content__inner> <header class=md-typeset> <h1 id=blog>Blog</h1> </header> <article class="md-post md-post--excerpt"> <header class=md-post__header> <nav class="md-post__authors md-typeset"> <span class=md-author> <img src=https://github.com/Roger-luo.png alt="Xiuzhe (Roger) Luo"> </span> </nav> <div class="md-post__meta md-meta"> <ul class=md-meta__list> <li class=md-meta__item> <time datetime="2024-11-11 00:00:00">November 11, 2024</time></li> <li class=md-meta__item> 10 min read </li> </ul> </div> </header> <div class="md-post__content md-typeset"> <h2 id=kirins-mission><a href=2024/11/11/kirins-mission/ class=toclink>Kirin's Mission</a></h2> <p>The field of scientific software has seen great development in the past decade. Scientists have been building more and more sophisticated simulators (quantum circuit simulators, differential equation solvers, differentiable solvers), and many different human controlable physical systems (neutral atoms, trapped ions, superconducting qubits, optical lattices, etc) that may be used for multiple purposes.</p> <p>These impressive progress urges the need for a more sophisticated way to interact with these simulators and physical systems. Yes, it's not just about new hardware, computation, afterall, is about how to compile a problem description to human-controlable physical systems. In software community, a domain-specific language (DSL) and a corresponding compiler is the way to go. However, building a DSL and a compiler is a non-trivial task, and it is not something that scientists are familiar with.</p> <p>This is why we are building Kirin - we want to provide a <strong>set of tools for scientists to build their own DSLs and making their DSLs composable with each other</strong>. This article is to explain the mission of Kirin, and why we are building it.</p> <h3 id=the-fragmentation-of-scientific-software><a class=toclink href=2024/11/11/kirins-mission/#the-fragmentation-of-scientific-software>The fragmentation of scientific software</a></h3> <p>I cannot talk about all scientific software, but software for quantum many-body system are already quite fragmented. For example, there are many different ways to represent sets of quantum operators system mathematically, such as tensor networks, quantum circuits, ZX diagrams<sup id=fnref:3><a class=footnote-ref href=2024/11/11/kirins-mission/#fn:3>1</a></sup>, operator table<sup id=fnref:4><a class=footnote-ref href=2024/11/11/kirins-mission/#fn:4>2</a></sup>, symbolic expressions, Quon<sup id=fnref:5><a class=footnote-ref href=2024/11/11/kirins-mission/#fn:5>3</a></sup>, etc. Each of these representations may result in a few different DSLs due to different design tradeoffs. In the lab, experimentalists also have different languages, such as pulse sequences, movings, QASM, QIR, etc. Almost every university lab has their own representation of the device, depsite of the sanity (e.g see last section). People have often been thinking if we can create a unified representation for all these problems, but it is not easy. Instead, the dream is: <strong>if we can make representations composable, we can build a unified representation by composing different representations from the experts.</strong></p> <p>We, at QuEra Computing Inc., naturally falls into this fragmentation problem, and thus have many duplicated representations in the past. Then the question is, how can we improve composability? There are already an answer in the software engineering community, which is the Multi-Level Intermediate Representation (MLIR). I like MLIR, but we are not using it. I will explain why.</p> <h3 id=why-didnt-use-x><a class=toclink href=2024/11/11/kirins-mission/#why-didnt-use-x>Why didn't use X?</a></h3> <p>This is a common question that one may ask when they see a new project. Here are some reasons why we are not using previous work.</p> <h4 id=why-not-use-mlir><a class=toclink href=2024/11/11/kirins-mission/#why-not-use-mlir>Why not use MLIR?</a></h4> <p>We have been trying to adopt MLIR since 2021, and we found that MLIR is a great project, but it is not easy to use for scientists. The scope of compilation problems that MLIR is trying to solve is too broad, and thus the complexity of the project is inevitably high. More specifically, we do not care about:</p> <ul> <li>low-level semantics</li> <li>traditional hardware targets</li> <li>high-quality native binary</li> <li>roundtrip-able IR text format</li> <li>speed of the compiler or the generated code <sup id=fnref:1><a class=footnote-ref href=2024/11/11/kirins-mission/#fn:1>4</a></sup></li> </ul> <p>We do care about:</p> <ul> <li>high-level semantics</li> <li>new optimization techniques for the scientific problems</li> <li>interpretation and JIT compilation</li> <li>a frontend that is easy to use for scientists</li> </ul> <p>In the quantum computing community, we have seen a lot of projects that are trying to build a quantum DSL and a compiler using MLIR. However, everyone will build</p> <ul> <li>their own set of dialects, including control-flow dialects</li> <li>Python frontend for the DSL</li> <li>another infrastructure to write IR passes in Python</li> </ul> <p>This is mainly because how to compile such program is still under research. Thus we expect normal scientists (e.g theoretical/experimental physicists) to write compiler passes. And it is impossible for them to learn MLIR within one week. As a result, MLIR was never adopted by broader quantum community.</p> <p>A few existing compilers focus on building an eDSL in Python then JIT compile the kernel to native binary. However, at least in our case, we have to decompile such native binary back to a JSON in order to run the program on a Python-based control system. It turns out what is really needed for a lot of scientists is:</p> <ul> <li>a way to write a high-level eDSL in Python <strong>(model of the problem)</strong></li> <li>then run some rewrites <strong>(problem simplification/compilation)</strong></li> <li>run it with an interpreter <strong>(model execution)</strong></li> <li>optionally compile it to another IR then run it with another interpreter. <strong>(simulation)</strong></li> </ul> <p>This seems to be the case not only for quantum physicists but other scientists such as the original machine-learning engineer's use case in <a href=https://discourse.llvm.org/t/rfc-mlir-interpreter-framework/63567>supporting interpreter framework in MLIR</a>. To support such use case, because MLIR needs to consider a lot more complicated senarios, it will take a lot of thinking to do it right.</p> <p>Big entities with sufficient bandwidth can afford doing this by hiring a lot of engineers with professional compiler engineering background, but for small companies and individual researchers, this is not feasible. We see the issue is due to the complexity of a generic problem, and the lack of involvement of scientists in the design of a compiler infrastructure. We believe that the solution is to build a more user-friendly compiler infrastructure by scientists for scientists. This is possible by limiting the program to</p> <ul> <li>only kernel functions (program size are small)</li> <li>only existing langauge (e.g Python) frontend (so that we can focus on designing composable lowering framework)</li> <li>focus on interpretation (or abstract interpretation), turn every compilation into different interpretation steps</li> <li>focus on Python-like type system</li> </ul> <h4 id=why-not-use-xdsl><a class=toclink href=2024/11/11/kirins-mission/#why-not-use-xdsl>Why not use xDSL?</a></h4> <p>Ok, after we have decided not to use MLIR, we were excited to see this project called <a href=https://github.com/xdslproject/xdsl>xDSL</a> around late 2023 and tried to play with it. However, we found that the project is still sophisticated for scientists to use. Mostly because the project is built by professional compiler engineers with a great familarity of MLIR. This is an advantage for the project to be able to support a wide range of problems and being able to interop with MLIR. The project is great, if you are interested in a friendlier version of MLIR in Python, you should definitely check it out. However, as a result, the priority of the project is not to build something scientists can get started with in a few days. What was missing from our wishlist is:</p> <ul> <li>composable Python lowering (e.g Python syntax claims from different dialects)</li> <li>different ways of interpretation (e.g abstract interpretation)</li> <li>Python type system instead of MLIR type attributes</li> <li>dialects that supports Python semantics instead of MLIR dialects</li> </ul> <p>while maybe eventually this would be in xDSL but more realistically, because the focus is quite different and xDSL was also new, the priorities are different.</p> <h4 id=why-not-julia-compiler-plugin><a class=toclink href=2024/11/11/kirins-mission/#why-not-julia-compiler-plugin>Why not Julia compiler plugin?</a></h4> <p>For those who are familiar with my past work, I have been working with Julia since 2015. This is a great language for scientific computing, and scientists with performance needs definitely love it. And in fact, the idea of building some infrastructure to help scientists to build their own DSLs and compilers was initially from the Julia community because of automatic differentiation and sparsity optimization (check the <a href=https://github.com/JuliaCompilerPlugins>CompilerPlugin org</a> and <a href=https://github.com/JuliaSymbolics/Symbolics.jl>Symbolics</a>+<a href=https://github.com/SciML/ModelingToolkit.jl>ModelingToolkit</a>). To enable automatic differentiation, we also end up building a small DSL in <a href=https://github.com/QuantumBFS/Yao.jl>Yao</a> to represent quantum circuits. In fact, to support automatic differentiation well, a lot of packages end up building their own DSLs and compilers.</p> <p>However, when I start moving towards a compiler for quantum circuit (<a href=https://github.com/QuantumBFS/YaoCompiler.jl>YaoCompiler</a>), the instability of the Julia compiler internal API quickly becomes a problem. On the other hand, the Julia SSA IR was not designed for custom DSLs, e.g it does not have the region semantics to represent hierarchical IRs, and it does not have the abstraction of dialects to allow composing different DSLs. While we have seen some promising progress in <a href=https://github.com/JuliaLabs/MLIR.jl>MLIR.jl</a>, the project is still in its early stage.</p> <p>On the other hand, I do get jelous of how Julia compiler solve the dynamic language compilation problem, thus I learnt a lot from the Julia compiler and the Julia compiler plugin. This results in the design of the Kirin type system, and the abstract interpretation framework. <sup id=fnref:2><a class=footnote-ref href=2024/11/11/kirins-mission/#fn:2>5</a></sup></p> <p>Python has been a hard requirement for us in building production software. But I reserve the right to use Julia to rewrite certain components of Kirin in the future.</p> <h4 id=why-not-use-jaxpr><a class=toclink href=2024/11/11/kirins-mission/#why-not-use-jaxpr>Why not use JAXPR?</a></h4> <p>JAX is a great project for automatic differentiation and scientific computing. I have been using it extensively for a few projects. While it is true that JAXPR covers a wide range of scientific computing tasks, it is not designed for more complicated tasks like quantum compilation, especially when you work at levels lower than quantum circuits. The limitation of JAX is intentionally designed to allow only tracing-based compilation, thus it does not support native Python control flows, and may not have clear function barriers in the traced program unless you use <code>jit</code> to separate them. The runtime value is restricted to JAX arrays, etc. These tradeoffs may not always be suitable for building a quantum program. The JAX compiler is designed for differentiable/machine-learning linear algebra programs afterall.</p> <h3 id=how-would-kirin-be-different><a class=toclink href=2024/11/11/kirins-mission/#how-would-kirin-be-different>How would Kirin be different?</a></h3> <p>While Kirin draws inspiration from MLIR, xDSL, Julia compiler plugin, and JAXPR, we aim to build a more user-friendly compiler infrastructure for scientists to solve their specific problems. There are nothing fundamentally new in theory, but the combination is new. Here are some key differences:</p> <p><strong>Composable Python Lowering</strong>, in our beer-lang example, the kernel decorator <code>@beer</code> is just a <code>DialectGroup</code> object that contains the <code>Dialect</code> objects you specified to include for the frontend. The Python syntax just maginally works! This is because Kirin features a composable lowering system that allows you to claim Python syntax from each separate dialect. When combining the dialects together, Kirin will be able to compile each Python syntax to the corresponding IR nodes, e.g</p> <ul> <li><code>func</code> dialect claims function related syntax: the <code>ast.FunctionDef</code>, nested <code>ast.FunctionDef</code> (as closures), <code>ast.Call</code>, <code>ast.Return</code>, etc.</li> <li><code>cf</code> (unstructured control flow) dialect claims control flow related syntax: <code>ast.If</code>, <code>assert</code>.</li> <li><code>math</code> dialect claims python builtin math functions</li> <li><code>py.stmts</code> claims miscellaneous other Python statements, e.g assignment, comparison, slice, range, etc.</li> </ul> <p>You can define your own lowering rules for new dialects, and compose with other dialects to build your own frontend.</p> <p><strong>Abstract Interpretation</strong>, inspired by Julia abstract interpreter, Kirin features a simple abstract interpretation framework that allows you to define how to interpret your own dialects on a given <a href=https://en.wikipedia.org/wiki/Lattice_(order)>lattice</a>. This allows Kirin to perform analysis such as constant propagation and type inference on your program. For example, like Julia, Kirin can perform constant propagation interprocedurally, and infer the types of your program, and this is composable with new dialects.</p> <p><strong>Python Type System</strong>, based on the abstract interpretation framework, the <code>py.types</code> dialect defines a Python type system as Kirin type attributes. This allows dynamic and generic definitions of dialects. This becomes quite useful defining high-level Python-like semantics, such as a statement taking a list of integers, or a statement taking a callable object. Taking the example from tests, you can just write the following in your frontend and let Kirin figure out the types</p> <div class=highlight><pre><span></span><code><span class=nd>@basic</span>
<span class=k>def</span> <span class=nf>foo</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
    <span class=k>if</span> <span class=n>x</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>1</span>
    <span class=k>else</span><span class=p>:</span>
        <span class=k>return</span> <span class=n>x</span> <span class=o>-</span> <span class=mf>1.0</span>


<span class=nd>@basic</span><span class=p>(</span><span class=n>typeinfer</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>main</span><span class=p>(</span><span class=n>x</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>foo</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>


<span class=nd>@basic</span><span class=p>(</span><span class=n>typeinfer</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
<span class=k>def</span> <span class=nf>moo</span><span class=p>(</span><span class=n>x</span><span class=p>):</span>
    <span class=k>return</span> <span class=n>foo</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</code></pre></div> <p>prints the following</p> <div class=highlight><pre><span></span><code><span class=n>moo</span><span class=o>.</span><span class=n>print</span><span class=p>()</span>
</code></pre></div> <p><img alt=typeinfer-basic src=typeinfer-basic.png></p> <p><em>while <code>py.types</code> supports generics, the type inference is still work-in-progress on generics.</em></p> <p><strong>IR Declaration Decorators</strong>, like <code>xDSL</code>, Kirin also provides the <code>statement</code> decorator to declare a new IR statement. However, the difference is Kirin focus on reducing extra terminologies and concepts that are not familiar to scientists with the cost of being more entangled with Python. The <code>statement</code> decorator is designed to be <code>@dataclass</code>-like, which is what scientists are familiar with. This is the only decorator one needs to know. Fields declared with native Python types are automatically converted to Kirin attributes via the Python type system.</p> <p>Taking an example from xDSL, you would define <code>Func</code> as</p> <div class=highlight><pre><span></span><code><span class=nd>@irdl_op_definition</span>
<span class=k>class</span> <span class=nc>FuncOp</span><span class=p>(</span><span class=n>IRDLOperation</span><span class=p>):</span>
    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;func.func&quot;</span>

    <span class=n>body</span> <span class=o>=</span> <span class=n>region_def</span><span class=p>()</span>
    <span class=n>sym_name</span> <span class=o>=</span> <span class=n>prop_def</span><span class=p>(</span><span class=n>StringAttr</span><span class=p>)</span>
    <span class=n>function_type</span> <span class=o>=</span> <span class=n>prop_def</span><span class=p>(</span><span class=n>FunctionType</span><span class=p>)</span>
    <span class=n>sym_visibility</span> <span class=o>=</span> <span class=n>opt_prop_def</span><span class=p>(</span><span class=n>StringAttr</span><span class=p>)</span>
    <span class=n>arg_attrs</span> <span class=o>=</span> <span class=n>opt_prop_def</span><span class=p>(</span><span class=n>ArrayAttr</span><span class=p>[</span><span class=n>DictionaryAttr</span><span class=p>])</span>
    <span class=n>res_attrs</span> <span class=o>=</span> <span class=n>opt_prop_def</span><span class=p>(</span><span class=n>ArrayAttr</span><span class=p>[</span><span class=n>DictionaryAttr</span><span class=p>])</span>

    <span class=n>traits</span> <span class=o>=</span> <span class=n>traits_def</span><span class=p>(</span>
        <span class=n>IsolatedFromAbove</span><span class=p>(),</span> <span class=n>SymbolOpInterface</span><span class=p>(),</span> <span class=n>FuncOpCallableInterface</span><span class=p>()</span>
    <span class=p>)</span>
</code></pre></div> <p>and you will need to define <code>__init__</code> etc. in the following. In Kirin, you would define <code>Func</code> as</p> <div class=highlight><pre><span></span><code><span class=nd>@statement</span><span class=p>(</span><span class=n>dialect</span><span class=o>=</span><span class=n>dialect</span><span class=p>)</span>
<span class=k>class</span> <span class=nc>Function</span><span class=p>(</span><span class=n>Statement</span><span class=p>):</span>
    <span class=n>name</span> <span class=o>=</span> <span class=s2>&quot;func&quot;</span>
    <span class=n>traits</span> <span class=o>=</span> <span class=nb>frozenset</span><span class=p>(</span>
        <span class=p>{</span>
            <span class=n>IsolatedFromAbove</span><span class=p>(),</span>
            <span class=n>SymbolOpInterface</span><span class=p>(),</span>
            <span class=n>HasSignature</span><span class=p>(),</span>
            <span class=n>FuncOpCallableInterface</span><span class=p>(),</span>
            <span class=n>SSACFGRegion</span><span class=p>(),</span>
        <span class=p>}</span>
    <span class=p>)</span>
    <span class=n>sym_name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>attribute</span><span class=p>(</span><span class=nb>property</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
    <span class=n>signature</span><span class=p>:</span> <span class=n>Signature</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>attribute</span><span class=p>()</span>
    <span class=n>body</span><span class=p>:</span> <span class=n>Region</span> <span class=o>=</span> <span class=n>info</span><span class=o>.</span><span class=n>region</span><span class=p>(</span><span class=n>multi</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</code></pre></div> <p>which is a more <code>@dataclass</code>-like definition, where fields with types are instance fields, and fields without types are (class) properties. The <code>@statement</code> also generates the corresponding <code>__init__</code> etc. just like a <code>@dataclass</code> (and your linter understands it!).</p> <h3 id=conclusion><a class=toclink href=2024/11/11/kirins-mission/#conclusion>Conclusion</a></h3> <p>When we start thinking about these scientific problems seriously, there seems not many in the software engineering community that would worry about the scientists. The scientists are living with a lot of workaround solutions, including but not limited to "define the language as a string, where each character represents an operation/statement, then let a human perform the control-flow" (the man in-the-loop). The compiler community are often excited about programming language for everything. However, for scientific community, especially nature science, there seems to be a big gap between the compiler community and the natural-science community (e.g a physicist like me) to make this come true.</p> <p>Kirin in its current form, may not be perfect (likely). However, we hope we can share this same vision for the scientific software community. So that Kirin, as a vision, can bridge this gap and help scientists to push the boundary of science with scientific software.</p> <div class=footnote> <hr> <ol> <li id=fn:3> <p>ZX diagrams can be seen as tensor networks too, but the implementation is usually different data structure.&#160;<a class=footnote-backref href=2024/11/11/kirins-mission/#fnref:3 title="Jump back to footnote 1 in the text">&#8617;</a></p> </li> <li id=fn:4> <p>Aaronson's stabilizer table, stochastic series expansion's operator table, etc.&#160;<a class=footnote-backref href=2024/11/11/kirins-mission/#fnref:4 title="Jump back to footnote 2 in the text">&#8617;</a></p> </li> <li id=fn:5> <p>Quon is a 3D representation of quantum operators.&#160;<a class=footnote-backref href=2024/11/11/kirins-mission/#fnref:5 title="Jump back to footnote 3 in the text">&#8617;</a></p> </li> <li id=fn:1> <p>this does not mean the program execution has to be very slow, e.g we can generate a different set of high-level IR that can be interpreted quickly (via optimized instruction implementation, etc.).&#160;<a class=footnote-backref href=2024/11/11/kirins-mission/#fnref:1 title="Jump back to footnote 4 in the text">&#8617;</a></p> </li> <li id=fn:2> <p>Kirin does not support multiple dispatch at the moment, this may be added in the future. I'm hesitating to add multiple dispatch because this turns out less useful for kernels because they can be embeded in host language abstraction most of the time.&#160;<a class=footnote-backref href=2024/11/11/kirins-mission/#fnref:2 title="Jump back to footnote 5 in the text">&#8617;</a></p> </li> </ol> </div> </div> </article> <nav class=md-pagination> </nav> </div> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../contrib/ class="md-footer__link md-footer__link--prev" aria-label="Previous: Contributing"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> Contributing </div> </div> </a> <a href=archive/2024/ class="md-footer__link md-footer__link--next" aria-label="Next: 2024"> <div class=md-footer__title> <span class=md-footer__direction> Next </span> <div class=md-ellipsis> 2024 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 Kirin contributors </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://x.com/QueraComputing target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"/></svg> </a> <a href=https://www.linkedin.com/company/quera-computing-inc/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.06 2.06 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065m1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["announce.dismiss", "content.action.view", "content.action.edit", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "navigation.footer", "search.highlight", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../assets/javascripts/bundle.83f73b43.min.js></script> </body> </html>